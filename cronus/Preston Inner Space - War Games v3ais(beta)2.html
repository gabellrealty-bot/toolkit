<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Starship Systems Sim ‚Äì Crew Tokens</title>
<style>
  body {
    margin: 0;
    background: #000;
    font-family: Arial, sans-serif;
    color: #fff;
  }

  .container {
    display: grid;
    grid-template-columns: 250px 1fr 300px;
    height: 100vh;
  }

  .left-panel, .right-panel {
    background: #111;
    padding: 10px;
    overflow-y: auto;
  }
  .left-panel { border-right: 2px solid #333; }
  .right-panel { border-left: 2px solid #333; }

  .map-area {
    position: relative;
    background: #000;
  }

  .map-image {
    width: 100%;
    height: 100%;
    object-fit: contain;
    display: block;
  }

  .grid-overlay {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    display: grid;
    grid-template-columns: repeat(40, 1fr);
    grid-template-rows: repeat(40, 1fr);
  }
  .grid-overlay div {
    border: 1px solid rgba(255,255,255,0.08);
    cursor: pointer;
    position: relative;
  }

  /* Crew token style */
  .crew-token {
    width: 80%;
    height: 80%;
    border-radius: 50%;
    margin: auto;
  }

  h2 {
    margin-top: 0;
    border-bottom: 1px solid #444;
    padding-bottom: 5px;
  }
</style>
</head>
<body>
<div class="container">

  <!-- Left Panel -->
  <div class="left-panel">
    <h2>Crew</h2>
    <button onclick="setActiveCrew('Rosa')">üëß Rosa</button>
    <button onclick="setActiveCrew('Bessy')">üëß Bessy</button>
    <button onclick="setActiveCrew('Maria')">üëß Maria</button>
    <button onclick="setActiveCrew('Neon')">üëß Neon</button>
    <button onclick="setActiveCrew('Sieta')">üßë‚ÄçüöÄ Sieta</button>
    <button onclick="setActiveCrew('Bessy Jr')">üë©‚Äçüé≠ Bessy Jr</button>
    <button onclick="setActiveCrew('Joshua')">üßë‚ÄçüöÄ Joshua</button>
    <button onclick="setActiveCrew('Isabella')">üë©‚Äçüé≠ Isabella</button>
    <button onclick="setActiveCrew('Bei')">üëß Bei</button>
    <button onclick="setActiveCrew('Lucina')">üëß Lucina</button>
    <button onclick="setActiveCrew('Helena')">üëß Helena</button>

   <div id="resources">
  <p>Power: <span id="power">99%</span></p>
  <p>Oxygen: <span id="oxygen">99%</span></p>
  <p>Fuel: <span id="fuel">65%</span></p>
  <p>Coolant: <span id="coolant">100%</span></p>
  <p>Pressure Levels: <span id="pressure">100%</span></p>
  <p>Quantum Flow: <span id="quantum">Stable</span></p>
</div>

	
	<h2>Icons: Services</h2>
<div class="icon-placeholder">
  <img src="icons-services.jpg" alt="Icons Menu" style="width:100%; height:auto;">
</div>


    <h2>Maps</h2>
    <button onclick="setMap('cronus-map.a.jpg')">Deck A</button>
    <button onclick="setMap('cronus-map.b.jpg')">Deck B</button>
    <button onclick="setMap('cronus-map.c.jpg')">Deck C</button>
    <button onclick="setMap('cronus-map.d.jpg')">Deck D</button>
  </div>

  <!-- Map Area -->
  <div class="map-area">
    <img id="mapImage" class="map-image" src="cronus-map.jpeg" alt="Ship Map">
    <div class="grid-overlay" id="grid"></div>
  </div>
  

  <!-- Right Panel -->
<div class="right-panel">
  <h2>Ship Systems</h2>
  <div id="shipSystems">
    <p>Reactor: Offline</p>
    <p>Life Support: Offline</p>
    <p>Engines: Offline</p>
    <p>Comms: Offline</p>
  </div>

  <div>
    <h2>Trigger Events</h2>
    <button onclick="reactorFailure()">Reactor Failure</button>
    <button onclick="oxygenLeak()">Oxygen Leak</button>
    <button onclick="coolantSpike()">Coolant Spike</button>
    <button onclick="engineStress()">Engine Stress</button>
    <button onclick="toggleAllSystems()">Toggle All Systems</button>
  </div>

  <h2>Events</h2>
  <div id="eventLog">No events yet.</div>

  <h2>Crew Stats</h2>
  <div id="crewStats"></div>
</div>
<!-- Error Codes Section -->
<h3>Error Codes</h3>
<div id="errorCodes">
  <button onclick="applyFix('E101')">Fix E101: Reactor Overload</button>
  <button onclick="applyFix('E202')">Fix E202: Oxygen Leak</button>
  <button onclick="applyFix('E303')">Fix E303: Fuel Contamination</button>
  <button onclick="applyFix('E404')">Fix E404: Coolant Imbalance</button>
</div>


<script>
function applyFix(code){
  switch(code){
    case 'E101': // Reactor Overload
      resources.power = Math.min(100, resources.power + 5);
      document.getElementById("eventLog").innerText = "Applied fix E101: Reactor stabilized.";
      break;

    case 'E202': // Oxygen Leak
      resources.oxygen = Math.min(100, resources.oxygen + 10);
      document.getElementById("eventLog").innerText = "Applied fix E202: Oxygen leak sealed.";
      break;

    case 'E303': // Fuel Contamination
      resources.fuel = Math.min(100, resources.fuel + 15);
      document.getElementById("eventLog").innerText = "Applied fix E303: Fuel purified.";
      break;

    case 'E404': // Coolant Imbalance
      resources.coolant = Math.min(100, resources.coolant + 10);
      resources.pressure = Math.min(100, (resources.pressure || 100) + 5);
      document.getElementById("eventLog").innerText = "Applied fix E404: Coolant balanced.";
      break;
  }

  // Update new metrics
  resources.pressure = resources.pressure || 100;
  resources.quantum = resources.quantum || "Stable";

  // Example dynamic change
  if(resources.power < 50){
    resources.quantum = "Unstable";
  } else {
    resources.quantum = "Stable";
  }

  updateResources();
}


let shipSystems = {
  reactor: false,
  lifeSupport: false,
  engines: false,
  comms: false
};

function updateShipSystems(){
  document.getElementById("shipSystems").innerText =
    `Reactor: ${shipSystems.reactor ? "Online" : "Offline"} (Deck ${currentDeck})
Life Support: ${shipSystems.lifeSupport ? "Online" : "Offline"} (Deck ${currentDeck})
Engines: ${shipSystems.engines ? "Online" : "Offline"} (Deck ${currentDeck})
Comms: ${shipSystems.comms ? "Online" : "Offline"} (Deck ${currentDeck})`;
}


function toggleAllSystems(){
  shipSystems.reactor = !shipSystems.reactor;
  shipSystems.lifeSupport = !shipSystems.lifeSupport;
  shipSystems.engines = !shipSystems.engines;
  shipSystems.comms = !shipSystems.comms;
  updateShipSystems();
  document.getElementById("eventLog").innerText =
    `All systems toggled ${shipSystems.reactor ? "Online" : "Offline"} on Deck ${currentDeck}`;
}

// Call once at startup
updateShipSystems();

// === System Events ===
function reactorFailure() {
  resources.power = Math.max(0, resources.power - 20);
  updateResources();
  document.getElementById("eventLog").innerText = "‚ö†Ô∏è Reactor failure! Power drained by 20%.";
  if (activeCrew) {
    crewStats[activeCrew].morale = Math.max(0, crewStats[activeCrew].morale - 5);
    updateCrewStats();
  }
}
function oxygenLeak() {
  resources.oxygen = Math.max(0, resources.oxygen - 15);
  updateResources();
  document.getElementById("eventLog").innerText = "‚ö†Ô∏è Oxygen leak! Oxygen reduced by 15%.";
  if (activeCrew) {
    crewStats[activeCrew].health = Math.max(0, crewStats[activeCrew].health - 5);
    updateCrewStats();
  }
}
function coolantSpike() {
  resources.coolant = Math.max(0, resources.coolant - 10);
  updateResources();
  document.getElementById("eventLog").innerText = "‚ö†Ô∏è Coolant spike! Coolant reduced by 10%.";
}
function engineStress() {
  resources.fuel = Math.max(0, resources.fuel - 10);
  updateResources();
  document.getElementById("eventLog").innerText = "‚ö†Ô∏è Engine stress! Fuel reduced by 10%.";
}

// === Crew stats ===
const crewStats = {
  "Rosa": {health:100, fatigue:0, morale:100, role:"crew"},
  "Bessy": {health:100, fatigue:0, morale:100, role:"crew"},
  "Maria": {health:100, fatigue:0, morale:100, role:"crew"},
  "Neon": {health:100, fatigue:0, morale:100, role:"crew"},
  "Sieta": {health:100, fatigue:0, morale:100, role:"captain"},
  "Bessy Jr": {health:100, fatigue:0, morale:100, role:"npc"},
  "Joshua": {health:100, fatigue:0, morale:100, role:"npc"},
  "Isabella": {health:100, fatigue:0, morale:100, role:"npc"},
  "Bei": {health:100, fatigue:0, morale:100, role:"crew"},
  "Lucina": {health:100, fatigue:0, morale:100, role:"crew"},
  "Helena": {health:100, fatigue:0, morale:100, role:"crew"}
};
const crewColors = {
  "Rosa":"pink","Bessy":"orange","Maria":"purple","Neon":"lime",
  "Sieta":"cyan","Bessy Jr":"yellow","Joshua":"blue",
  "Isabella":"red","Bei":"magenta","Lucina":"teal","Helena":"white"
};
const crewTokens = {};
const crewPositions = {};
let activeCrew = null;

// === Resources ===
let resources = { power:100, oxygen:100, fuel:100, coolant:100 };
function updateResources(){
  document.getElementById("power").innerText=`Power: ${resources.power}%`;
  document.getElementById("oxygen").innerText=`Oxygen: ${resources.oxygen}%`;
  document.getElementById("fuel").innerText=`Fuel: ${resources.fuel}%`;
  document.getElementById("coolant").innerText=`Coolant: ${resources.coolant}%`;
}
function updateCrewStats(){
  const statsDiv=document.getElementById("crewStats");
  statsDiv.innerHTML="";
  if(activeCrew){
    const s=crewStats[activeCrew];
    statsDiv.innerHTML=`<p><strong>${activeCrew}</strong> (Role: ${s.role})<br>
    Health: ${s.health}% | Fatigue: ${s.fatigue}% | Morale: ${s.morale}%</p>`;
  }
}
function setActiveCrew(name){
  activeCrew=name;
  document.getElementById("eventLog").innerText=`${name} selected`;
  updateCrewStats();
}

// === Rooms object (Deck A, restorative edits) ===
const roomsA = {
  "Stairwell - Upper/Lower Decks": { rows:[19,23], cols:[20,24], effect:(c)=>{ crewStats[c].fatigue+=5; updateCrewStats(); }},
  "Junction A-1": { rows:[19,23], cols:[25,29], effect:(c)=>{ crewStats[c].fatigue+=5; updateCrewStats(); }},
  "MU/TH/UR 2000": { rows:[19,23], cols:[29,33], effect:(c)=>{ crewStats[c].morale+=10; crewStats[c].fatigue+=5; updateCrewStats(); }},
  "Air Scrubbers Shaft": { rows:[19,23], cols:[18,22], effect:(c)=>{ crewStats[c].health-=5; crewStats[c].fatigue+=5; updateCrewStats(); }},
  "Main MRL Interface": { rows:[14,18], cols:[16,20], effect:(c)=>{ crewStats[c].morale+=15; crewStats[c].fatigue=Math.max(0,crewStats[c].fatigue-10); updateCrewStats(); }},
  "Cryo 1": { rows:[17,21], cols:[15,19], effect:(c)=>{ crewStats[c].health=Math.min(100,crewStats[c].health+20); crewStats[c].fatigue=Math.max(0,crewStats[c].fatigue-20); updateCrewStats(); }},
  "Cryo 2": { rows:[21,25], cols:[15,19], effect:(c)=>{ crewStats[c].health=Math.min(100,crewStats[c].health+20); crewStats[c].fatigue=Math.max(0,crewStats[c].fatigue-20); updateCrewStats(); }},
  "Cryo 3": { rows:[19,23], cols:[13,17], effect:(c)=>{ crewStats[c].health=Math.min(100,crewStats[c].health+20); crewStats[c].fatigue=Math.max(0,crewStats[c].fatigue-20); updateCrewStats(); }},
  "Examination Room": { rows:[19,23], cols:[11,15], effect:(c)=>{ crewStats[c].morale-=20; crewStats[c].fatigue+=10; updateCrewStats(); }},
  "Showers & Wardrobe 1": { rows:[22,26], cols:[11,15], effect:(c)=>{ crewStats[c].fatigue=Math.max(0,crewStats[c].fatigue-15); crewStats[c].morale+=10; updateCrewStats(); }},
  "Showers & Wardrobe 2": { rows:[16,20], cols:[11,15], effect:(c)=>{ crewStats[c].fatigue=Math.max(0,crewStats[c].fatigue-15); crewStats[c].morale+=10; updateCrewStats(); }},
  "Junction A-2": { rows:[19,23], cols:[7,11], effect:(c)=>{ reactorFailure(); crewStats[c].morale=Math.max(0,crewStats[c].morale-10); updateCrewStats(); }},
  "Quantum Log": { rows:[25,29], cols:[16,20], effect:(c)=>{ crewStats[c].morale-=30; crewStats[c].fatigue+=20; updateCrewStats(); }}
};


// === Rooms object (Deck B, restorative edits) ===
const rooms = {
  "Bridge": { rows:[19,23], cols:[34,38], effect:(c)=>{ crewStats[c].morale=Math.min(100,crewStats[c].morale+2); updateCrewStats(); }},
  "Med Lab": { rows:[15,19], cols:[12,16], effect:(c)=>{ crewStats[c].health=Math.min(100,crewStats[c].health+20); crewStats[c].fatigue=Math.max(0,crewStats[c].fatigue-10); updateCrewStats(); }},
  "Reactor Core": { rows:[19,23], cols:[7,11], effect:(c)=>{ reactorFailure(); crewStats[c].morale=Math.max(0,crewStats[c].morale-5); updateCrewStats(); }},
  "Science Module": { rows:[19,23], cols:[3,7], effect:(c)=>{ crewStats[c].morale=Math.min(100,crewStats[c].morale+1); updateCrewStats(); }},
  "Mess Hall": { rows:[23,27], cols:[19,23], effect:(c)=>{ crewStats[c].health=Math.min(100,crewStats[c].health+10); crewStats[c].fatigue=Math.max(0,crewStats[c].fatigue-15); crewStats[c].morale=Math.min(100,crewStats[c].morale+15); updateCrewStats(); }},
  "Pilot Station 1": { rows:[16,20], cols:[32,36], effect:(c)=>{ crewStats[c].fatigue+=2; crewStats[c].morale+=1; updateCrewStats(); }},
  "Pilot Station 2": { rows:[21,25], cols:[32,36], effect:(c)=>{ crewStats[c].fatigue+=2; crewStats[c].morale+=1; updateCrewStats(); }},
  "Life Support": { rows:[21,25], cols:[30,34], effect:(c)=>{ crewStats[c].health+=5; crewStats[c].morale+=2; updateCrewStats(); }},
  "Sensor Station": { rows:[16,20], cols:[30,34], effect:(c)=>{ crewStats[c].fatigue+=5; crewStats[c].morale-=2; updateCrewStats(); }},
  "Holo Display Table": { rows:[19,23], cols:[31,35], effect:(c)=>{ crewStats[c].morale+=2; updateCrewStats(); }},
  "Comm Station": { rows:[19,23], cols:[29,33], effect:(c)=>{ crewStats[c].morale+=3; updateCrewStats(); }},
  "Junction B-1": { rows:[19,23], cols:[25,29], effect:(c)=>{ crewStats[c].fatigue+=5; updateCrewStats(); }},
  "Vestible 1 - Armory": { rows:[15,19], cols:[25,29], effect:(c)=>{ crewStats[c].morale-=5; crewStats[c].fatigue+=5; updateCrewStats(); }},
  "Vestible 2 - EVA Suits": { rows:[23,27], cols:[25,29], effect:(c)=>{ crewStats[c].morale+=2; crewStats[c].fatigue=Math.max(0,crewStats[c].fatigue-2); updateCrewStats(); }},
  "Storage Closet": { rows:[15,19], cols:[22,26], effect:(c)=>{ crewStats[c].fatigue+=3; updateCrewStats(); }},
  "Stairwell - Upper/Lower Decks": { rows:[19,23], cols:[20,24], effect:(c)=>{ crewStats[c].fatigue+=5; updateCrewStats(); }},
  "Air Scrubbers Shaft": { rows:[19,23], cols:[18,22], effect:(c)=>{ crewStats[c].health-=5; crewStats[c].fatigue+=5; updateCrewStats(); }},
  "Corporate Suite w/EEV": { rows:[15,19], cols:[19,23], effect:(c)=>{ crewStats[c].health=Math.min(100,crewStats[c].health+15); crewStats[c].fatigue=Math.max(0,crewStats[c].fatigue-20); crewStats[c].morale=Math.min(100,crewStats[c].morale+20); updateCrewStats(); }},
 
  "Mech A": { rows:[25,29], cols:[16,20], effect:(c)=>{ crewStats[c].fatigue+=5; crewStats[c].morale-=2; updateCrewStats(); }},
  "Living Area 1": {
    rows:[23,27], cols:[15,19],
    effect:(c)=>{
      document.getElementById("eventLog").innerText += " ‚Äî Rest and comfort.";
      crewStats[c].health = Math.min(100, crewStats[c].health+10);
      crewStats[c].fatigue = Math.max(0, crewStats[c].fatigue-20);
      crewStats[c].morale = Math.min(100, crewStats[c].morale+20);
      updateCrewStats();
    }
  },
  "Living Area 2": {
    rows:[19,23], cols:[15,19],
    effect:(c)=>{
      document.getElementById("eventLog").innerText += " ‚Äî Rest and comfort.";
      crewStats[c].health = Math.min(100, crewStats[c].health+10);
      crewStats[c].fatigue = Math.max(0, crewStats[c].fatigue-20);
      crewStats[c].morale = Math.min(100, crewStats[c].morale+20);
      updateCrewStats();
    }
  },
  "Living Area 3": {
    rows:[15,19], cols:[15,19],
    effect:(c)=>{
      document.getElementById("eventLog").innerText += " ‚Äî Rest and comfort.";
      crewStats[c].health = Math.min(100, crewStats[c].health+10);
      crewStats[c].fatigue = Math.max(0, crewStats[c].fatigue-20);
      crewStats[c].morale = Math.min(100, crewStats[c].morale+20);
      updateCrewStats();
    }
  },
  "Captain Quarters": {
  rows:[15,19], cols:[17,21],
  effect:(c)=>{
    document.getElementById("eventLog").innerText += " ‚Äî Private sanctuary.";
    crewStats[c].health = Math.min(100, crewStats[c].health+20);
    crewStats[c].fatigue = Math.max(0, crewStats[c].fatigue-25);
    crewStats[c].morale = Math.min(100, crewStats[c].morale+25);
    updateCrewStats();
  }
},
"Mech B": {
  rows:[12,16], cols:[16,20],
  effect:(c)=>{
    document.getElementById("eventLog").innerText += " ‚Äî Mechanical strain.";
    crewStats[c].fatigue+=5;
    crewStats[c].morale-=2;
    updateCrewStats();
  }
},

  "Access Terminal": {
    rows:[21,25], cols:[14,18],
    effect:(c)=>{
      crewStats[c].morale+=3;
      crewStats[c].fatigue+=2;
      updateCrewStats();
    }
  },
  "Medpods": {
    rows:[15,19], cols:[10,14],
    effect:(c)=>{
      document.getElementById("eventLog").innerText += " ‚Äî Intensive healing.";
      crewStats[c].health = 100; // full restore
      crewStats[c].fatigue = Math.max(0, crewStats[c].fatigue-30);
      crewStats[c].morale = Math.min(100, crewStats[c].morale+10);
      updateCrewStats();
    }
  },
  "Sci Lab 2": { rows:[21,25], cols:[12,16], effect:(c)=>{ crewStats[c].morale+=2; crewStats[c].fatigue+=5; updateCrewStats(); }},
  "Sci Lab 1 w/storage": { rows:[23,27], cols:[10,14], effect:(c)=>{ crewStats[c].morale+=2; crewStats[c].fatigue+=5; updateCrewStats(); }},
  "Junction B2": { rows:[19,23], cols:[10,14], effect:(c)=>{ crewStats[c].fatigue+=5; updateCrewStats(); }},
  "Command Station": { rows:[19,23], cols:[36,40], effect:(c)=>{ crewStats[c].fatigue+=10; crewStats[c].morale-=5; updateCrewStats(); }}
};


// === Rooms object (Deck C, Cargo Deck) ===
const roomsC = {
  "Junction C-1": { rows:[19,23], cols:[25,29], effect:(c)=>{ crewStats[c].fatigue+=5; updateCrewStats(); }},
  "Cargo Bay 1": { rows:[14,18], cols:[19,23], effect:(c)=>{ crewStats[c].fatigue=Math.max(0,crewStats[c].fatigue-10); crewStats[c].morale+=10; updateCrewStats(); }},
  "Cargo Bay 2": { rows:[23,27], cols:[19,23], effect:(c)=>{ crewStats[c].fatigue=Math.max(0,crewStats[c].fatigue-15); crewStats[c].morale+=15; updateCrewStats(); }},
  "Catwalk 1 - Open to Deck D": { rows:[21,25], cols:[17,21], effect:(c)=>{ crewStats[c].morale+=5; updateCrewStats(); }},
  "Catwalk 2 - Open to Deck D": { rows:[17,21], cols:[17,21], effect:(c)=>{ crewStats[c].morale+=5; updateCrewStats(); }},
  "Catwalk 3 - Open Center to Deck D": { rows:[19,23], cols:[13,17], effect:(c)=>{ crewStats[c].morale+=5; updateCrewStats(); }},
  "Cargo Office": { rows:[13,17], cols:[15,19], effect:(c)=>{ crewStats[c].fatigue+=5; updateCrewStats(); }},
  "Balcony & Asset Log": { rows:[19,23], cols:[11,15], effect:(c)=>{ crewStats[c].morale+=10; updateCrewStats(); }},
  "Junction C-2": { rows:[19,23], cols:[7,11], effect:(c)=>{ reactorFailure(); crewStats[c].morale-=10; updateCrewStats(); }},
  "Coolant Tank 1": { rows:[14,18], cols:[9,13], effect:(c)=>{ crewStats[c].fatigue=Math.max(0,crewStats[c].fatigue-10); updateCrewStats(); }},
  "Coolant Tank 2": { rows:[23,27], cols:[9,13], effect:(c)=>{ crewStats[c].fatigue=Math.max(0,crewStats[c].fatigue-10); updateCrewStats(); }},
  "Maintenance 1": { rows:[15,19], cols:[11,15], effect:(c)=>{ crewStats[c].fatigue+=5; updateCrewStats(); }},
  "Maintenance 2": { rows:[23,27], cols:[11,15], effect:(c)=>{ crewStats[c].fatigue+=5; updateCrewStats(); }},
  "Reactor Relay Control": { rows:[23,27], cols:[7,11], effect:(c)=>{ crewStats[c].morale-=20; crewStats[c].fatigue+=10; updateCrewStats(); }},
  "Storage Closet 1": { rows:[14,18], cols:[23,27], effect:(c)=>{ crewStats[c].fatigue+=5; updateCrewStats(); }},
  "Storage Closet 2": { rows:[23,27], cols:[23,27], effect:(c)=>{ crewStats[c].fatigue+=5; updateCrewStats(); }}
};

// === Rooms object (Deck D, Vehicle Deck) ===
const roomsD = {
  "Vehicle Bay": { rows:[19,23], cols:[17,21], effect:(c)=>{ crewStats[c].morale+=5; crewStats[c].fatigue=Math.max(0,crewStats[c].fatigue-10); updateCrewStats(); }},
  "Equipment Shed": { rows:[15,19], cols:[7,11], effect:(c)=>{ crewStats[c].fatigue+=10; crewStats[c].morale-=5; updateCrewStats(); }},
  "Vehicle Parts & Storage": { rows:[19,23], cols:[7,11], effect:(c)=>{ reactorFailure(); crewStats[c].morale-=10; updateCrewStats(); }},
  "Dispatch Office": { rows:[25,29], cols:[7,11], effect:(c)=>{ crewStats[c].fatigue+=5; crewStats[c].morale-=10; updateCrewStats(); }}
};

let currentDeck = "B"; // default starting deck

function crewMove(row, col, name) {
  let deckRooms;
  if (currentDeck === "A") deckRooms = roomsA;
  else if (currentDeck === "B") deckRooms = roomsB;
  else if (currentDeck === "C") deckRooms = roomsC;
  else if (currentDeck === "D") deckRooms = roomsD;
  else {
    console.error("Deck not defined:", currentDeck);
    return;
  }

  let inRoom = false;
  for (const room in deckRooms) {
    const {rows, cols, effect} = deckRooms[room];
    if (row >= rows[0] && row <= rows[1] && col >= cols[0] && col <= cols[1]) {
      document.getElementById("eventLog").innerText =
        `${name} arrived at Row ${row+1}, Column ${col+1} (${room})`;
      if (effect) effect(name);
      inRoom = true;
      break;
    }
  }

  if (!inRoom) {
    resources.oxygen = Math.max(0, resources.oxygen - 1);
    resources.power = Math.max(0, resources.power - 1);
    crewStats[name].fatigue = Math.min(100, crewStats[name].fatigue + 2);
    crewStats[name].morale = Math.max(0, crewStats[name].morale - 1);
    document.getElementById("eventLog").innerText =
      `${name} arrived at Row ${row+1}, Column ${col+1}`;
  }

  updateResources();
  updateCrewStats();
}
function setMap(filename){
  // Update the map image
  document.getElementById("mapImage").src = filename;

  // Extract deck ID from filename (cronus-map.a.jpg, cronus-map.b.jpg, etc.)
  const match = filename.match(/cronus-map\.(a|b|c|d)/i);
  if (match) {
    currentDeck = match[1].toUpperCase(); // A, B, C, or D
  } else {
    currentDeck = "?"; // fallback if filename doesn't match
  }

  // Fuel cost for switching decks
  resources.fuel = Math.max(0, resources.fuel - 5);
  updateResources();

  // Log the deck switch
  document.getElementById("eventLog").innerText =
    `Switched to ${filename} (Deck ${currentDeck})`;

  // Clear crew tokens when changing decks
  for (const crew in crewTokens) {
    if (crewTokens[crew]) {
      crewTokens[crew].remove();
      crewTokens[crew] = null;
      crewPositions[crew] = null;
    }
  }

  // Refresh Ship Systems panel with new deck ID
  updateShipSystems();
}

// === Crew movement ===
function crewMove(row, col, name){
  // Select the correct room set based on currentDeck
  let deckRooms;
  if (currentDeck === "A") deckRooms = roomsA;
  else if (currentDeck === "B") deckRooms = roomsB;
  else if (currentDeck === "C") deckRooms = roomsC;
  else if (currentDeck === "D") deckRooms = roomsD;
  else deckRooms = {}; // fallback

  let inRoom = false;

  // Check if crew is inside a defined room
  for (const room in deckRooms){
    const {rows, cols, effect} = deckRooms[room];
    if (row >= rows[0] && row <= rows[1] && col >= cols[0] && col <= cols[1]){
      document.getElementById("eventLog").innerText =
        `${name} arrived at Row ${row+1}, Col ${col+1} (${room}) on Deck ${currentDeck}`;
      if (effect) effect(name);
      inRoom = true;
      break;
    }
  }

  // Corridor movement (not inside a room)
  if (!inRoom){
    resources.oxygen--;
    resources.power--;
    crewStats[name].fatigue += 2;
    crewStats[name].morale--;
    document.getElementById("eventLog").innerText =
      `${name} arrived at Row ${row+1}, Col ${col+1} (corridor) on Deck ${currentDeck}`;
  }

  updateResources();
  updateCrewStats();
  updateShipSystems();
}


// === Map switching ===
function setMap(filename) {
  document.getElementById("mapImage").src = filename;
  resources.fuel = Math.max(0, resources.fuel - 5);
  updateResources();
  document.getElementById("eventLog").innerText = `Switched to ${filename}`;
  for (const crew in crewTokens) {
    if (crewTokens[crew]) {
      crewTokens[crew].remove();
      crewTokens[crew] = null;
      crewPositions[crew] = null;
    }
  }
}

// === Pathfinding animation ===
function moveCrewAnimated(name, targetRow, targetCol) {
  if (!crewTokens[name]) return;
  let currentRow = crewPositions[name]?.row ?? 0;
  let currentCol = crewPositions[name]?.col ?? 0;
  const steps = [];
  while (currentCol !== targetCol) {
    currentCol += (targetCol > currentCol ? 1 : -1);
    steps.push({row: currentRow, col: currentCol});
  }
  while (currentRow !== targetRow) {
    currentRow += (targetRow > currentRow ? 1 : -1);
    steps.push({row: currentRow, col: currentCol});
  }
  let i = 0;
  const interval = setInterval(() => {
    if (i >= steps.length) {
      clearInterval(interval);
      crewPositions[name] = {row: targetRow, col: targetCol};
      crewMove(targetRow, targetCol, name);
      return;
    }
    crewTokens[name].remove();
    const step = steps[i];
    const cell = [...grid.children].find(c =>
      parseInt(c.dataset.row) === step.row &&
      parseInt(c.dataset.col) === step.col
    );
    const token = document.createElement("div");
    token.classList.add("crew-token");
    token.style.backgroundColor = crewColors[name];
    cell.appendChild(token);
    crewTokens[name] = token;
    i++;
  }, 200);
}

// =======================================================
// Build Grid (40x40 clickable cells)
// =======================================================
const grid = document.getElementById("grid");

for (let row = 0; row < 40; row++) {
  for (let col = 0; col < 40; col++) {
    const cell = document.createElement("div");
    cell.dataset.row = row;
    cell.dataset.col = col;

    // When a cell is clicked, move the active crew
    cell.addEventListener("click", () => {
      // If crew token doesn't exist yet, create it
      if (!crewTokens[activeCrew]) {
        const token = document.createElement("div");
        token.className = "crew-token";
        token.style.backgroundColor = crewColors[activeCrew];
        cell.appendChild(token);

        crewTokens[activeCrew] = token;
        crewPositions[activeCrew] = { row, col };
      }

      // Move crew into this cell
      crewMove(row, col, activeCrew);
    });

    grid.appendChild(cell);
  }
}

</script>

</body>
</html>

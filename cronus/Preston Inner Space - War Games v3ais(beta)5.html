<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Starship Systems Sim â€“ Crew Tokens</title>
<style>
  .friendly-select {
    width: 250px; /* adjust to whatever fits your UI */
  }
</style>

<style>
  body {
    margin: 0;
    background: #000;
    font-family: Arial, sans-serif;
    color: #fff;
  }

  .container {
    display: grid;
    grid-template-columns: 250px 1fr 300px;
    height: 100vh;
  }

  .left-panel, .right-panel {
    background: #111;
    padding: 10px;
    overflow-y: auto;
  }
  .left-panel { border-right: 2px solid #333; }
  .right-panel { border-left: 2px solid #333; }

  .map-area {
    position: relative;
    background: #000;
  }

  .map-image {
    width: 100%;
    height: 100%;
    object-fit: contain;
    display: block;
  }

  .grid-overlay {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    display: grid;
    grid-template-columns: repeat(40, 1fr);
    grid-template-rows: repeat(40, 1fr);
  }
  .grid-overlay div {
    border: 1px solid rgba(255,255,255,0.08);
    cursor: pointer;
    position: relative;
  }

  /* Crew token style */
  .crew-token {
    width: 80%;
    height: 80%;
    border-radius: 50%;
    margin: auto;
  }

  h2 {
    margin-top: 0;
    border-bottom: 1px solid #444;
    padding-bottom: 5px;
  }
  .good { color: #2ecc71; }   /* green */
.warn { color: #f1c40f; }   /* yellow */
.danger { color: #e74c3c; } /* red */
}

</style>
</head>
<body>
<div class="container">

  <!-- Left Panel -->
  <div class="left-panel">
    <h2>Crew</h2>
    <button onclick="setActiveCrew('Rosa')">ğŸ‘§ Rosa</button>
    <button onclick="setActiveCrew('Bessy')">ğŸ‘§ Bessy</button>
    <button onclick="setActiveCrew('Maria')">ğŸ‘§ Maria</button>
    <button onclick="setActiveCrew('Neon')">ğŸ‘§ Neon</button>
    <button onclick="setActiveCrew('Sieta')">ğŸ§‘â€ğŸš€ Sieta</button>
    <button onclick="setActiveCrew('Bessy Jr')">ğŸ‘©â€ğŸ­ Bessy Jr</button>
    <button onclick="setActiveCrew('Joshua')">ğŸ§‘â€ğŸš€ Joshua</button>
    <button onclick="setActiveCrew('Isabella')">ğŸ‘©â€ğŸ­ Isabella</button>
    <button onclick="setActiveCrew('Bei')">ğŸ‘§ Bei</button>
    <button onclick="setActiveCrew('Lucina')">ğŸ‘§ Lucina</button>
    <button onclick="setActiveCrew('Helena')">ğŸ‘§ Helena</button>
    <button onclick="setActiveCrew('James Reed')">ğŸ§‘ James Reed</button> <button onclick="setActiveCrew('Emily Patel')">ğŸ‘© Emily Patel</button> <button onclick="setActiveCrew('Ryan Jenkins')">ğŸ§‘ Ryan Jenkins</button> <button onclick="setActiveCrew('Michael Lee')">ğŸ§‘ Michael Lee</button> <button onclick="setActiveCrew('Samantha Rodriguez')">ğŸ‘© Samantha Rodriguez</button> <button onclick="setActiveCrew('Victor Garcia')">ğŸ§‘ Victor Garcia</button> <button onclick="setActiveCrew('Lisa Nguyen')">ğŸ‘© Lisa Nguyen</button> <button onclick="setActiveCrew('Eric Thompson')">ğŸ§‘ Eric Thompson</button> <button onclick="setActiveCrew('Jasmine Singh')">ğŸ‘© Jasmine Singh</button> <button onclick="setActiveCrew('Mark Taylor')">ğŸ§‘ Mark Taylor</button> <button onclick="setActiveCrew('David Kim')">ğŸ§‘ David Kim</button> <button onclick="setActiveCrew('Antonio Vasquez')">ğŸ§‘ Antonio Vasquez</button>
    <h2>Resources</h2>
    <p id="power">Power: 100%</p>
    <p id="oxygen">Oxygen: 100%</p>
    <p id="fuel">Fuel: 100%</p>
    <p id="coolant">Coolant: 100%</p>
	
	<p id="las">LAS: 20</p>

    <p id="bal">BAL: 48</p>

    <p id="msl">MSL: 298</p>

    <p id="hull">HULL: 906</p>

    <p id="shield">SHIELD: 730</p>

    <p id="cargo">CARGO: 2200</p>
	
	<h2>Icons: Services</h2>
<div class="icon-placeholder">
  <img src="icons-services.jpg" alt="Icons Menu" style="width:163px; height:500px;">
</div>


    <h2>Maps</h2>
    <button onclick="setMap('cronus-map.a.jpg')">Deck A</button>
    <button onclick="setMap('cronus-map.b.jpg')">Deck B</button>
    <button onclick="setMap('cronus-map.c.jpg')">Deck C</button>
    <button onclick="setMap('cronus-map.d.jpg')">Deck D</button>
  </div>

  <!-- Map Area -->
  <div class="map-area">
    <img id="mapImage" class="map-image" src="cronus-map.jpeg" alt="Ship Map">
    <div class="grid-overlay" id="grid"></div>
  </div>
  

  <!-- Right Panel -->
<div class="right-panel">
<div class="section">




<div class="friendly-type">
  <label class="friendly-label">Navigation Control</label>

  <select class="friendly-select" aria-label="Inspection type" onchange="document.getElementById('selected-output').textContent = this.options[this.selectedIndex].text;">
    <option value="1">1. Antigua and Barbuda â€” Friendly</option>
    <option value="2">2. El Salvador â€” Friendly</option>
    <option value="3">3. Trinidad and Tobago â€” Friendly</option>
    <option value="4">4. Colombia â€” Friendly</option>
    <option value="5">5. Costa Rica â€” Friendly</option>
    <option value="6">6. Guatemala â€” Friendly</option>
    <option value="7">7. United Kingdom â€” Friendly</option>
    <option value="8">8. United States â€” Non-Friendly</option>
    <option value="9">9. France â€” Friendly</option>
    <option value="10">10. Peru â€” Friendly</option>
    <option value="11">11. Belgium â€” Friendly</option>
    <option value="12">12. Italy â€” Friendly</option>
    <option value="13">13. Nicaragua â€” Friendly</option>
    <option value="14">14. Chile â€” Friendly</option>
    <option value="15">15. Dominican Republic â€” Friendly</option>
    <option value="16">16. Mexico â€” Friendly</option>
    <option value="17">17. Venezuela â€” Friendly</option>
    <option value="18">18. Spain â€” Friendly</option>
    <option value="19">19. Ecuador â€” Friendly</option>
    <option value="20">20. Cuba â€” Friendly</option>
    <option value="21">21. Brazil â€” Friendly</option>
    <option value="22">22. Panama â€” Friendly</option>
    <option value="23">Holy See â€” Friendly</option>
    <option value="24">23. Argentina â€” Friendly</option>
    <option value="25">24. Uruguay â€” Friendly</option>
    <option value="26">25. Czech Republic â€” Friendly</option>
    <option value="27">26. Poland â€” Friendly</option>
    <option value="28">27. Japan â€” Friendly</option>
    <option value="29">28. Sweden â€” Friendly</option>
    <option value="30">29. Netherlands â€” Friendly</option>
    <option value="31">30. Denmark â€” Friendly</option>
    <option value="32">31. Philippines â€” Friendly</option>
    <option value="33">32. Norway â€” Friendly</option>
    <option value="34">33. Paraguay â€” Friendly</option>
    <option value="35">34. Israel â€” Friendly</option>
    <option value="36">35. Turkey â€” Friendly</option>
    <option value="37">36. Lebanon â€” Friendly</option>
    <option value="38">37. Serbia â€” Friendly</option>
    <option value="39">38. Austria â€” Friendly</option>
    <option value="40">39. Switzerland â€” Friendly</option>
    <option value="41">40. Portugal â€” Friendly</option>
    <option value="42">41. Germany â€” Friendly</option>
    <option value="43">42. Canada â€” Friendly</option>
    <option value="44">43. South Korea â€” Friendly</option>
    <option value="45">44. Greece â€” Friendly</option>
    <option value="46">45. Hungary â€” Friendly</option>
    <option value="47">46. Romania â€” Friendly</option>
    <option value="48">47. Jamaica â€” Friendly</option>
    <option value="49">48. Finland â€” Friendly</option>
    <option value="50">49. Luxembourg â€” Friendly</option>
    <option value="51">50. Suriname â€” Friendly</option>
    <option value="52">51. Belize â€” Friendly</option>
    <option value="53">52. Australia â€” Friendly</option>
    <option value="54">53. Morocco â€” Friendly</option>
    <option value="55">54. Singapore â€” Friendly</option>
    <option value="56">55. Thailand â€” Friendly</option>
    <option value="57">56. Egypt â€” Friendly</option>
    <option value="58">57. New Zealand â€” Friendly</option>
    <option value="59">58. Saint Vincent and the Grenadines â€” Friendly</option>
    <option value="60">59. Russia â€” Friendly</option>
    <option value="61">60. Brunei â€” Friendly</option>
    <option value="62">61. Guyana â€” Friendly</option>
    <option value="63">62. Kuwait â€” Friendly</option>
    <option value="64">63. Barbados â€” Friendly</option>
    <option value="65">64. Bahamas â€” Friendly</option>
    <option value="66">65. India â€” Friendly</option>
    <option value="67">66. Burkina Faso â€” Friendly</option>
    <option value="68">67. Algeria â€” Friendly</option>
    <option value="69">68. Azerbaijan â€” Friendly</option>
    <option value="70">69. Kazakhstan â€” Friendly</option>
    <option value="71">70. Cambodia â€” Friendly</option>
    <option value="72">71. United Arab Emirates â€” Friendly</option>
    <option value="73">72. South Africa â€” Friendly</option>
    <option value="74">73. Slovenia â€” Friendly</option>
    <option value="75">74. North Macedonia â€” Friendly</option>
    <option value="76">75. Jordan â€” Friendly</option>
    <option value="77">76. Andorra â€” Friendly</option>
    <option value="78">77. Indonesia â€” Friendly</option>
    <option value="79">78. Croatia â€” Friendly</option>
    <option value="80">79. Ireland â€” Friendly</option>
    <option value="81">80. Bahrain â€” Friendly</option>
    <option value="82">81. Saudi Arabia â€” Friendly</option>
    <option value="83">82. Belarus â€” Friendly</option>
    <option value="84">83. Ukraine â€” Friendly</option>
    <option value="85">84. Bolivia â€” Friendly</option>
    <option value="86">85. Estonia â€” Friendly</option>
    <option value="87">86. Latvia â€” Friendly</option>
    <option value="88">87. Slovakia â€” Friendly</option>
    <option value="89">88. Bulgaria â€” Friendly</option>
    <option value="90">89. Malta â€” Friendly</option>
    <option value="91">90. Iceland â€” Friendly</option>
    <option value="92">91. Lithuania â€” Friendly</option>
    <option value="93">92. Cyprus â€” Friendly</option>
    <option value="94">93. Vietnam â€” Friendly</option>
    <option value="95">94. Nepal â€” Friendly</option>
    <option value="96">95. Uzbekistan â€” Friendly</option>
    <option value="97">96. Libya â€” Friendly</option>
    <option value="98">97. Botswana â€” Friendly</option>
    <option value="99">98. Montenegro â€” Friendly</option>
    <option value="100">99. Albania â€” Friendly</option>
    <option value="101">Kosovo â€” Friendly</option>
    <option value="102">100. Bosnia and Herzegovina â€” Friendly</option>
    <option value="103">101. Senegal â€” Friendly</option>
    <option value="104">102. Monaco â€” Friendly</option>
    <option value="105">103. Georgia â€” Friendly</option>
    <option value="106">104. Zambia â€” Friendly</option>
    <option value="107">105. Ghana â€” Friendly</option>
    <option value="108">106. Mauritius â€” Friendly</option>
    <option value="109">107. Armenia â€” Friendly</option>
    <option value="110">108. Maldives â€” Friendly</option>
    <option value="111">109. Mongolia â€” Friendly</option>
    <option value="112">110. Qatar â€” Friendly</option>
    <option value="113">111. Haiti â€” Friendly</option>
    <option value="114">112. Sri Lanka â€” Friendly</option>
    <option value="115">State of Palestine â€” Friendly</option>
    <option value="116">Sahrawi Arab Democratic Republic â€” Friendly</option>
    <option value="117">113. Grenada â€” Friendly</option>
    <option value="118">114. Malaysia â€” Friendly</option>
    <option value="119">115. Nigeria â€” Friendly</option>
    <option value="120">116. San Marino â€” Friendly</option>
    <option value="121">117. Pakistan â€” Friendly</option>
    <option value="122">118. Dominica â€” Friendly</option>
    <option value="123">119. Saint Lucia â€” Friendly</option>
    <option value="124">120. Fiji â€” Friendly</option>
    <option value="125">121. Bangladesh â€” Friendly</option>
    <option value="126">122. Saint Kitts and Nevis â€” Friendly</option>
    <option value="127">123. Marshall Islands â€” Friendly</option>
    <option value="128">124. Equatorial Guinea â€” Friendly</option>
    <option value="129">125. Mauritania â€” Friendly</option>
    <option value="130">126. Liechtenstein â€” Friendly</option>
    <option value="131">127. Kenya â€” Friendly</option>
    <option value="132">128. China â€” Friendly</option>
    <option value="133">129. Kyrgyzstan â€” Friendly</option>
    <option value="134">130. Turkmenistan â€” Friendly</option>
    <option value="135">131. Moldova â€” Friendly</option>
  </select>

  <span id="selected-output" class="inspection-badge" aria-hidden="false"></span>
</div>






  <h2>ğŸ§­ Command Console</h2>

  <button onclick="issueCommand('Launch')">ğŸš€ Launch</button>
  <button onclick="issueCommand('Abort')">â›” Abort</button>
  <button onclick="issueCommand('Deploy Solar Array')">ğŸ”† Deploy Solar Array</button>
  <button onclick="issueCommand('Adjust Thrust')">ğŸ”¥ Adjust Thrust</button>
  <button onclick="issueCommand('Land')">ğŸª‚ Land</button>
  <button onclick="issueCommand('Dock')">ğŸ§² Dock</button>
  <button onclick="issueCommand('Orbit')">ğŸŒ€ Orbit</button>
  <button onclick="issueCommand('Hail')">ğŸ“¡ Hail</button>
  <button onclick="issueCommand('Arm Weapons')">ğŸ›¡ Arm Weapons</button>

  <!-- ğŸŒŒ Warp Speed Ritual -->
  <button onclick="issueCommand('Engage Warp Speed')">âš¡ Engage Warp Speed</button>

  <!-- ğŸ§² Gravity Toggle -->
  <button onclick="issueCommand('Gravity Off')">ğŸŒ‘ Gravity Off</button>
  <button onclick="issueCommand('Gravity On')">ğŸŒ Gravity On</button>

  <p id="commandLog" style="margin-top:10px; font-style:italic;"></p>
</div>


<h2>Events</h2>
  <div id="eventLog">No events yet.</div>

  <h2>Crew Stats</h2>
  <div id="crewStats"></div>

  
  
<div class="section">
  <h2>ğŸ§ª System Checks</h2>

  <p><span class="highlight">Propulsion:</span> <span id="healthPropulsion">Nominal</span></p>
  <p><span class="highlight">Communications:</span> <span id="healthComms">Nominal</span></p>
  <p><span class="highlight">Thermal Control:</span> <span id="healthThermal">Nominal</span></p>
  <p><span class="highlight">Power System:</span> <span id="healthPower">Nominal</span></p>
  <p><span class="highlight">Navigation:</span> <span id="healthNavigation">Nominal</span></p>

  <button onclick="runDiagnostics()">ğŸ” Run Diagnostics</button>
  <p id="diagnosticLog" style="margin-top:10px; font-style:italic;"></p>
</div>

  <h2>Ship Systems</h2>
  <div id="shipSystems">
    <p>Reactor: Offline</p>
    <p>Life Support: Offline</p>
    <p>Engines: Offline</p>
    <p>Comms: Offline</p>
  </div>

<div class="section">
  <h2>ğŸ§­ Auto Pilot Control</h2>
  <button onclick="toggleAutoPilot(true)">ğŸ¤– Auto Pilot On</button>
  <button onclick="toggleAutoPilot(false)">ğŸ›‘ Auto Pilot Off</button>
  <p id="autoPilotLog" style="margin-top:10px; font-style:italic;"></p>
</div>

  <div>
    <h2>Trigger Events</h2>
    <button onclick="reactorFailure()">Reactor Failure</button>
    <button onclick="oxygenLeak()">Oxygen Leak</button>
    <button onclick="coolantSpike()">Coolant Spike</button>
    <button onclick="engineStress()">Engine Stress</button>
    <button onclick="toggleAllSystems()">Toggle All Systems</button>
  </div>

  
  <h3>Error Codes</h3>
<div id="errorCodes">
  <button onclick="applyFix('E101')">Fix E101:</button> // Reactor Overload
  <button onclick="applyFix('E202')">Fix E202:</button> //Oxygen Leak
  <button onclick="applyFix('E303')">Fix E303:</button> //Fuel Contamination
  <button onclick="applyFix('E404')">Fix E404:</button> //Coolant Imbalance
  <button onclick="applyFix('E501')">Fix E501:</button>// Main Airlock Damaged 
<button onclick="applyFix('E502')">Fix E502:</button> // Air Scrubbers Offline 
<button onclick="applyFix('E503')">Fix E503:</button> //Cryo 3 Area Sealed Off
<button onclick="applyFix('E504')">Fix E504:</button> //Science Module Jettison Malfunction
<button onclick="applyFix('E505')">Fix E505:</button> //Pilot Station 2 Not Operational
<button onclick="applyFix('E506')">Fix E506: </button>//Sensor Station Damaged
<button onclick="applyFix('E507')">Fix E507: </button>//Radiation Leak
<button onclick="applyFix('E508')">Fix E508: </button>//Vehicle Bay Side Airlocks Damaged

</div>

</div>


<script>
function issueCommand(command) {
  let logMessage = "";

  switch(command) {
    case "Launch":
      logMessage = "ğŸš€ Launch sequence initiated. Fuel and power draining, crew brace for ascent.";
      break;

    case "Abort":
      logMessage = "â›” Abort command issued. Systems winding down.";
      break;

    case "Deploy Solar Array":
      logMessage = "ğŸ”† Solar Array deployed. Power output increasing.";
      document.getElementById("powerOutput").innerText = "100%";
      break;

    case "Adjust Thrust":
      logMessage = "ğŸ”¥ Thrust adjusted. Engines responding.";
      break;

    case "Land":
      logMessage = "ğŸª‚ Landing sequence engaged. Prepare for descent.";
      break;

    case "Dock":
      logMessage = "ğŸ§² Docking procedure initiated. Aligning with station.";
      break;

    case "Orbit":
      logMessage = "ğŸŒ€ Orbit command executed. Stabilizing trajectory.";
      break;

    case "Hail":
      logMessage = "ğŸ“¡ Hailing signal sent. Awaiting response.";
      break;

    case "Arm Weapons":
      logMessage = "ğŸ›¡ Weapons armed. Systems on standby.";
      break;

    case "Engage Warp Speed":
      logMessage = "âš¡ Warp Speed engaged! Ship surges forward.";
      break;

    case "Gravity Off":
      logMessage = "ğŸŒ‘ Gravity systems disengaged. Crew floating.";
      break;

    case "Gravity On":
      logMessage = "ğŸŒ Gravity systems engaged. Normal conditions restored.";
      break;

    default:
      logMessage = `Unknown command: ${command}`;
  }

  document.getElementById("commandLog").innerText = logMessage;
}


function runDiagnostics() {
  const systems = [
    { id: "healthPropulsion", name: "Propulsion" },
    { id: "healthComms", name: "Communications" },
    { id: "healthThermal", name: "Thermal Control" },
    { id: "healthPower", name: "Power System" },
    { id: "healthNavigation", name: "Navigation" }
  ];

  let log = "Diagnostics Report:\n";

  systems.forEach(sys => {
    // Randomize status for testing
    const status = Math.random() > 0.2 ? "Nominal" : "âš ï¸ Warning";
    document.getElementById(sys.id).innerText = status;
    log += `${sys.name}: ${status}\n`;
  });

  document.getElementById("diagnosticLog").innerText = log;
}


let autoPilotEnabled = false;

function toggleAutoPilot(state) {
  autoPilotEnabled = state;
  if(autoPilotEnabled){
    document.getElementById("autoPilotLog").innerText = "Auto Pilot engaged â€” navigation systems handling course corrections.";
    // Example effect: stabilize navigation automatically
    resources.power = Math.max(0, resources.power - 2);
    resources.navigation = "Stable";
  } else {
    document.getElementById("autoPilotLog").innerText = "Auto Pilot disengaged â€” manual control required.";
  }
  updateResources();
  updateShipSystems();
}


function applyFix(code) {
  switch(code){
    case 'E101': resources.power = Math.min(100, resources.power+5); break;
    case 'E202': resources.oxygen = Math.min(100, resources.oxygen+10); break;
    case 'E303': resources.fuel = Math.min(100, resources.fuel+15); break;
    case 'E404': resources.coolant = Math.min(100, resources.coolant+10);
                 resources.pressure = Math.min(100, resources.pressure+5); break;
	case 'E501': // Main Airlock Damaged (Deck A)
  resources.oxygen = Math.max(0, resources.oxygen - 10);
  resources.pressure = Math.max(0, resources.pressure - 5);
  break;

case 'E502': // Air Scrubbers Offline (Deck A)
  resources.oxygen = Math.max(0, resources.oxygen - 15);
  break;

case 'E503': // Cryo 3 Area Seal Off (Deck A)
  resources.pressure = Math.max(0, resources.pressure - 10);
  crewStats[name].morale = Math.max(0, crewStats[name].morale - 5);
  break;

case 'E504': // Science Module Jettison Malfunction (Deck A)
  resources.power = Math.max(0, resources.power - 10);
  resources.fuel = Math.max(0, resources.fuel - 5);
  break;

case 'E505': // Pilot Station 2 Not Operational (Deck B)
  resources.power = Math.max(0, resources.power - 5);
  break;

case 'E506': // Sensor Station Damaged (Deck B)
  resources.power = Math.max(0, resources.power - 5);
  resources.quantum = "Unstable";
  break;

case 'E507': // Radiation Leak (Deck C)
  resources.coolant = Math.max(0, resources.coolant - 10);
  resources.pressure = Math.max(0, resources.pressure - 10);
  break;

case 'E508': // Vehicle Bay Side Airlocks Damaged (Deck D)
  resources.oxygen = Math.max(0, resources.oxygen - 10);
  resources.pressure = Math.max(0, resources.pressure - 5);
  break;

  }
  resources.quantum = resources.power < 50 ? "Unstable" : "Stable";
  updateResources();
  document.getElementById("eventLog").innerText = `Applied fix ${code}`;
}


let shipSystems = {
  reactor: false,
  lifeSupport: false,
  engines: false,
  comms: false
};

function updateShipSystems(){
  document.getElementById("shipSystems").innerHTML =
    `<p>Reactor: ${shipSystems.reactor ? "Online" : "Offline"}</p>
     <p>Life Support: ${shipSystems.lifeSupport ? "Online" : "Offline"}</p>
     <p>Engines: ${shipSystems.engines ? "Online" : "Offline"}</p>
     <p>Comms: ${shipSystems.comms ? "Online" : "Offline"}</p>`;
}

function toggleAllSystems(){
  shipSystems.reactor = !shipSystems.reactor;
  shipSystems.lifeSupport = !shipSystems.lifeSupport;
  shipSystems.engines = !shipSystems.engines;
  shipSystems.comms = !shipSystems.comms;
  updateShipSystems();
  document.getElementById("eventLog").innerText =
    `All systems toggled ${shipSystems.reactor ? "Online" : "Offline"} on Deck ${currentDeck}`;
}

// Call once at startup
updateShipSystems();

// === System Events ===
function reactorFailure() {
  resources.power = Math.max(0, resources.power - 20);
  updateResources();
  document.getElementById("eventLog").innerText = "âš ï¸ Reactor failure! Power drained by 20%.";
  if (activeCrew) {
    crewStats[activeCrew].morale = Math.max(0, crewStats[activeCrew].morale - 5);
    updateCrewStats();
  }
}
function oxygenLeak() {
  resources.oxygen = Math.max(0, resources.oxygen - 15);
  updateResources();
  document.getElementById("eventLog").innerText = "âš ï¸ Oxygen leak! Oxygen reduced by 15%.";
  if (activeCrew) {
    crewStats[activeCrew].health = Math.max(0, crewStats[activeCrew].health - 5);
    updateCrewStats();
  }
}
function coolantSpike() {
  resources.coolant = Math.max(0, resources.coolant - 10);
  updateResources();
  document.getElementById("eventLog").innerText = "âš ï¸ Coolant spike! Coolant reduced by 10%.";
}
function engineStress() {
  resources.fuel = Math.max(0, resources.fuel - 10);
  updateResources();
  document.getElementById("eventLog").innerText = "âš ï¸ Engine stress! Fuel reduced by 10%.";
}

// === Crew stats ===
const crewStats = {
  "Rosa": {health:100, fatigue:0, morale:100, role:"crew"},
  "Bessy": {health:100, fatigue:0, morale:100, role:"crew"},
  "Maria": {health:100, fatigue:0, morale:100, role:"crew"},
  "Neon": {health:100, fatigue:0, morale:100, role:"crew"},
  "Sieta": {health:100, fatigue:0, morale:100, role:"captain"},
  "Bessy Jr": {health:100, fatigue:0, morale:100, role:"npc"},
  "Joshua": {health:100, fatigue:0, morale:100, role:"npc"},
  "Isabella": {health:100, fatigue:0, morale:100, role:"npc"},
  "Bei": {health:100, fatigue:0, morale:100, role:"crew"},
  "Lucina": {health:100, fatigue:0, morale:100, role:"crew"},
  "Helena": {health:100, fatigue:0, morale:100, role:"crew"}
  "James Reed": {health:100, fatigue:0, morale:100, role:"crew"}, "Emily Patel": {health:100, fatigue:0, morale:100, role:"crew"}, "Ryan Jenkins": {health:100, fatigue:0, morale:100, role:"crew"}, "Michael Lee": {health:100, fatigue:0, morale:100, role:"crew"}, "Samantha Rodriguez": {health:100, fatigue:0, morale:100, role:"crew"}, "Victor Garcia": {health:100, fatigue:0, morale:100, role:"crew"}, "Lisa Nguyen": {health:100, fatigue:0, morale:100, role:"crew"}, "Eric Thompson": {health:100, fatigue:0, morale:100, role:"crew"}, "Jasmine Singh": {health:100, fatigue:0, morale:100, role:"crew"}, "Mark Taylor": {health:100, fatigue:0, morale:100, role:"crew"}, "David Kim": {health:100, fatigue:0, morale:100, role:"crew"}, "Antonio Vasquez": {health:100, fatigue:0, morale:100, role:"crew"}
};
const crewColors = {
  "Rosa":"pink","Bessy":"orange","Maria":"purple","Neon":"lime",
  "Sieta":"cyan","Bessy Jr":"yellow","Joshua":"blue",
  "Isabella":"red","Bei":"magenta","Lucina":"teal","Helena":"white",
  "James Reed":"silver", "Emily Patel":"plum", "Ryan Jenkins":"steelblue", "Michael Lee":"navy", "Samantha Rodriguez":"salmon", "Victor Garcia":"gold", "Lisa Nguyen":"turquoise", "Eric Thompson":"forestgreen", "Jasmine Singh":"orchid", "Mark Taylor":"slategray", "David Kim":"dodgerblue", "Antonio Vasquez":"chocolate"
};
const crewTokens = {};
const crewPositions = {};
let activeCrew = null;

// === Resources ===
let resources = {
  power: 100,
  oxygen: 100,
  fuel: 100,
  coolant: 100,
  las: 20,
  bal: 48,
  msl: 298,
  hull: 906,
  shield: 730,
  cargo: 2200,
  crew: 3,
  jumpRange: 19,
  mobility: 71,
  topSpeed: 130,
  mass: 2508
};

function updateResources(){
  setColor("power", resources.power, "%");
  setColor("oxygen", resources.oxygen, "%");
  setColor("fuel", resources.fuel, "%");
  setColor("coolant", resources.coolant, "%");

  setColor("las", resources.las);
  setColor("bal", resources.bal);
  setColor("msl", resources.msl);

  setColor("hull", resources.hull);
  setColor("shield", resources.shield);

  setColor("cargo", resources.cargo);
  setColor("crew", resources.crew);

  setColor("jumprange", resources.jumpRange, "LY");
  setColor("mobility", resources.mobility);
  setColor("topspeed", resources.topSpeed);
  setColor("mass", resources.mass);
}

function setColor(id, value, suffix=""){
  const el = document.getElementById(id);
  el.textContent = `${id.toUpperCase()}: ${value}${suffix}`;

  // Apply thresholds
  el.classList.remove("good","warn","danger");
  if(value <= 25 || (id==="hull" && value < 200) || (id==="shield" && value < 300)){
    el.classList.add("danger");
  } else if(value < 50){
    el.classList.add("warn");
  } else {
    el.classList.add("good");
  }
}


// === Crew Stats ===
function updateCrewStats(){
  const statsDiv = document.getElementById("crewStats");
  statsDiv.innerHTML = "";
  if(activeCrew){
    const s = crewStats[activeCrew];
    statsDiv.innerHTML = `<p><strong>${activeCrew}</strong> (Role: ${s.role})<br>
    Health: ${s.health}% | Fatigue: ${s.fatigue}% | Morale: ${s.morale}%</p>`;
  }
}

function setActiveCrew(name){
  activeCrew = name;
  document.getElementById("eventLog").innerText = `${name} selected`;
  updateCrewStats();

  // If selecting a new crew member should increase max crew:
  if(!resources.recruited) resources.recruited = [];
  if(!resources.recruited.includes(name)){
    resources.recruited.push(name);
    resources.crew = resources.recruited.length; // update MAX CREW count
    updateResources();
  }
}


// === Rooms object (Deck A, restorative edits) ===
const roomsA = {
  "Stairwell - Upper/Lower Decks": { rows:[19,23], cols:[20,24], effect:(c)=>{ crewStats[c].fatigue+=5; updateCrewStats(); }},
  "Junction A-1": { rows:[19,23], cols:[25,29], effect:(c)=>{ crewStats[c].fatigue+=5; updateCrewStats(); }},
  "MU/TH/UR 2000": { rows:[19,23], cols:[29,33], effect:(c)=>{ crewStats[c].morale+=10; crewStats[c].fatigue+=5; updateCrewStats(); }},
  "Air Scrubbers Shaft": { rows:[19,23], cols:[18,22], effect:(c)=>{ crewStats[c].health-=5; crewStats[c].fatigue+=5; updateCrewStats(); }},
  "Main MRL Interface": { rows:[14,18], cols:[16,20], effect:(c)=>{ crewStats[c].morale+=15; crewStats[c].fatigue=Math.max(0,crewStats[c].fatigue-10); updateCrewStats(); }},
  "Cryo 1": { rows:[17,21], cols:[15,19], effect:(c)=>{ crewStats[c].health=Math.min(100,crewStats[c].health+20); crewStats[c].fatigue=Math.max(0,crewStats[c].fatigue-20); updateCrewStats(); }},
  "Cryo 2": { rows:[21,25], cols:[15,19], effect:(c)=>{ crewStats[c].health=Math.min(100,crewStats[c].health+20); crewStats[c].fatigue=Math.max(0,crewStats[c].fatigue-20); updateCrewStats(); }},
  "Cryo 3": { rows:[19,23], cols:[13,17], effect:(c)=>{ crewStats[c].health=Math.min(100,crewStats[c].health+20); crewStats[c].fatigue=Math.max(0,crewStats[c].fatigue-20); updateCrewStats(); }},
  "Examination Room": { rows:[19,23], cols:[11,15], effect:(c)=>{ crewStats[c].morale-=20; crewStats[c].fatigue+=10; updateCrewStats(); }},
  "Showers & Wardrobe 1": { rows:[22,26], cols:[11,15], effect:(c)=>{ crewStats[c].fatigue=Math.max(0,crewStats[c].fatigue-15); crewStats[c].morale+=10; updateCrewStats(); }},
  "Showers & Wardrobe 2": { rows:[16,20], cols:[11,15], effect:(c)=>{ crewStats[c].fatigue=Math.max(0,crewStats[c].fatigue-15); crewStats[c].morale+=10; updateCrewStats(); }},
  "Junction A-2": { rows:[19,23], cols:[7,11], effect:(c)=>{ reactorFailure(); crewStats[c].morale=Math.max(0,crewStats[c].morale-10); updateCrewStats(); }},
  "Quantum Log": { rows:[25,29], cols:[16,20], effect:(c)=>{ crewStats[c].morale-=30; crewStats[c].fatigue+=20; updateCrewStats(); }}
};


// === Rooms object (Deck B, restorative edits) ===
const rooms = {
  "Bridge": { rows:[19,23], cols:[34,38], effect:(c)=>{ crewStats[c].morale=Math.min(100,crewStats[c].morale+2); updateCrewStats(); }},
  "Med Lab": { rows:[15,19], cols:[12,16], effect:(c)=>{ crewStats[c].health=Math.min(100,crewStats[c].health+20); crewStats[c].fatigue=Math.max(0,crewStats[c].fatigue-10); updateCrewStats(); }},
  "Reactor Core": { rows:[19,23], cols:[7,11], effect:(c)=>{ reactorFailure(); crewStats[c].morale=Math.max(0,crewStats[c].morale-5); updateCrewStats(); }},
  "Science Module": { rows:[19,23], cols:[3,7], effect:(c)=>{ crewStats[c].morale=Math.min(100,crewStats[c].morale+1); updateCrewStats(); }},
  "Mess Hall": { rows:[23,27], cols:[19,23], effect:(c)=>{ crewStats[c].health=Math.min(100,crewStats[c].health+10); crewStats[c].fatigue=Math.max(0,crewStats[c].fatigue-15); crewStats[c].morale=Math.min(100,crewStats[c].morale+15); updateCrewStats(); }},
  "Pilot Station 1": { rows:[16,20], cols:[32,36], effect:(c)=>{ crewStats[c].fatigue+=2; crewStats[c].morale+=1; updateCrewStats(); }},
  "Pilot Station 2": { rows:[21,25], cols:[32,36], effect:(c)=>{ crewStats[c].fatigue+=2; crewStats[c].morale+=1; updateCrewStats(); }},
  "Life Support": { rows:[21,25], cols:[30,34], effect:(c)=>{ crewStats[c].health+=5; crewStats[c].morale+=2; updateCrewStats(); }},
  "Sensor Station": { rows:[16,20], cols:[30,34], effect:(c)=>{ crewStats[c].fatigue+=5; crewStats[c].morale-=2; updateCrewStats(); }},
  "Holo Display Table": { rows:[19,23], cols:[31,35], effect:(c)=>{ crewStats[c].morale+=2; updateCrewStats(); }},
  "Comm Station": { rows:[19,23], cols:[29,33], effect:(c)=>{ crewStats[c].morale+=3; updateCrewStats(); }},
  "Junction B-1": { rows:[19,23], cols:[25,29], effect:(c)=>{ crewStats[c].fatigue+=5; updateCrewStats(); }},
  "Vestible 1 - Armory": { rows:[15,19], cols:[25,29], effect:(c)=>{ crewStats[c].morale-=5; crewStats[c].fatigue+=5; updateCrewStats(); }},
  "Vestible 2 - EVA Suits": { rows:[23,27], cols:[25,29], effect:(c)=>{ crewStats[c].morale+=2; crewStats[c].fatigue=Math.max(0,crewStats[c].fatigue-2); updateCrewStats(); }},
  "Storage Closet": { rows:[15,19], cols:[22,26], effect:(c)=>{ crewStats[c].fatigue+=3; updateCrewStats(); }},
  "Stairwell - Upper/Lower Decks": { rows:[19,23], cols:[20,24], effect:(c)=>{ crewStats[c].fatigue+=5; updateCrewStats(); }},
  "Air Scrubbers Shaft": { rows:[19,23], cols:[18,22], effect:(c)=>{ crewStats[c].health-=5; crewStats[c].fatigue+=5; updateCrewStats(); }},
  "Corporate Suite w/EEV": { rows:[15,19], cols:[19,23], effect:(c)=>{ crewStats[c].health=Math.min(100,crewStats[c].health+15); crewStats[c].fatigue=Math.max(0,crewStats[c].fatigue-20); crewStats[c].morale=Math.min(100,crewStats[c].morale+20); updateCrewStats(); }},
 
  "Mech A": { rows:[25,29], cols:[16,20], effect:(c)=>{ crewStats[c].fatigue+=5; crewStats[c].morale-=2; updateCrewStats(); }},
  "Living Area 1": {
    rows:[23,27], cols:[15,19],
    effect:(c)=>{
      document.getElementById("eventLog").innerText += " â€” Rest and comfort.";
      crewStats[c].health = Math.min(100, crewStats[c].health+10);
      crewStats[c].fatigue = Math.max(0, crewStats[c].fatigue-20);
      crewStats[c].morale = Math.min(100, crewStats[c].morale+20);
      updateCrewStats();
    }
  },
  "Living Area 2": {
    rows:[19,23], cols:[15,19],
    effect:(c)=>{
      document.getElementById("eventLog").innerText += " â€” Rest and comfort.";
      crewStats[c].health = Math.min(100, crewStats[c].health+10);
      crewStats[c].fatigue = Math.max(0, crewStats[c].fatigue-20);
      crewStats[c].morale = Math.min(100, crewStats[c].morale+20);
      updateCrewStats();
    }
  },
  "Living Area 3": {
    rows:[15,19], cols:[15,19],
    effect:(c)=>{
      document.getElementById("eventLog").innerText += " â€” Rest and comfort.";
      crewStats[c].health = Math.min(100, crewStats[c].health+10);
      crewStats[c].fatigue = Math.max(0, crewStats[c].fatigue-20);
      crewStats[c].morale = Math.min(100, crewStats[c].morale+20);
      updateCrewStats();
    }
  },
  "Captain Quarters": {
  rows:[15,19], cols:[17,21],
  effect:(c)=>{
    document.getElementById("eventLog").innerText += " â€” Private sanctuary.";
    crewStats[c].health = Math.min(100, crewStats[c].health+20);
    crewStats[c].fatigue = Math.max(0, crewStats[c].fatigue-25);
    crewStats[c].morale = Math.min(100, crewStats[c].morale+25);
    updateCrewStats();
  }
},
"Mech B": {
  rows:[12,16], cols:[16,20],
  effect:(c)=>{
    document.getElementById("eventLog").innerText += " â€” Mechanical strain.";
    crewStats[c].fatigue+=5;
    crewStats[c].morale-=2;
    updateCrewStats();
  }
},

  "Access Terminal": {
    rows:[21,25], cols:[14,18],
    effect:(c)=>{
      crewStats[c].morale+=3;
      crewStats[c].fatigue+=2;
      updateCrewStats();
    }
  },
  "Medpods": {
    rows:[15,19], cols:[10,14],
    effect:(c)=>{
      document.getElementById("eventLog").innerText += " â€” Intensive healing.";
      crewStats[c].health = 100; // full restore
      crewStats[c].fatigue = Math.max(0, crewStats[c].fatigue-30);
      crewStats[c].morale = Math.min(100, crewStats[c].morale+10);
      updateCrewStats();
    }
  },
  "Sci Lab 2": { rows:[21,25], cols:[12,16], effect:(c)=>{ crewStats[c].morale+=2; crewStats[c].fatigue+=5; updateCrewStats(); }},
  "Sci Lab 1 w/storage": { rows:[23,27], cols:[10,14], effect:(c)=>{ crewStats[c].morale+=2; crewStats[c].fatigue+=5; updateCrewStats(); }},
  "Junction B2": { rows:[19,23], cols:[10,14], effect:(c)=>{ crewStats[c].fatigue+=5; updateCrewStats(); }},
  "Command Station": { rows:[19,23], cols:[36,40], effect:(c)=>{ crewStats[c].fatigue+=10; crewStats[c].morale-=5; updateCrewStats(); }}
};


// === Rooms object (Deck C, Cargo Deck) ===
const roomsC = {
  "Junction C-1": { rows:[19,23], cols:[25,29], effect:(c)=>{ crewStats[c].fatigue+=5; updateCrewStats(); }},
  "Cargo Bay 1": { rows:[14,18], cols:[19,23], effect:(c)=>{ crewStats[c].fatigue=Math.max(0,crewStats[c].fatigue-10); crewStats[c].morale+=10; updateCrewStats(); }},
  "Cargo Bay 2": { rows:[23,27], cols:[19,23], effect:(c)=>{ crewStats[c].fatigue=Math.max(0,crewStats[c].fatigue-15); crewStats[c].morale+=15; updateCrewStats(); }},
  "Catwalk 1 - Open to Deck D": { rows:[21,25], cols:[17,21], effect:(c)=>{ crewStats[c].morale+=5; updateCrewStats(); }},
  "Catwalk 2 - Open to Deck D": { rows:[17,21], cols:[17,21], effect:(c)=>{ crewStats[c].morale+=5; updateCrewStats(); }},
  "Catwalk 3 - Open Center to Deck D": { rows:[19,23], cols:[13,17], effect:(c)=>{ crewStats[c].morale+=5; updateCrewStats(); }},
  "Cargo Office": { rows:[13,17], cols:[15,19], effect:(c)=>{ crewStats[c].fatigue+=5; updateCrewStats(); }},
  "Balcony & Asset Log": { rows:[19,23], cols:[11,15], effect:(c)=>{ crewStats[c].morale+=10; updateCrewStats(); }},
  "Junction C-2": { rows:[19,23], cols:[7,11], effect:(c)=>{ reactorFailure(); crewStats[c].morale-=10; updateCrewStats(); }},
  "Coolant Tank 1": { rows:[14,18], cols:[9,13], effect:(c)=>{ crewStats[c].fatigue=Math.max(0,crewStats[c].fatigue-10); updateCrewStats(); }},
  "Coolant Tank 2": { rows:[23,27], cols:[9,13], effect:(c)=>{ crewStats[c].fatigue=Math.max(0,crewStats[c].fatigue-10); updateCrewStats(); }},
  "Maintenance 1": { rows:[15,19], cols:[11,15], effect:(c)=>{ crewStats[c].fatigue+=5; updateCrewStats(); }},
  "Maintenance 2": { rows:[23,27], cols:[11,15], effect:(c)=>{ crewStats[c].fatigue+=5; updateCrewStats(); }},
  "Reactor Relay Control": { rows:[23,27], cols:[7,11], effect:(c)=>{ crewStats[c].morale-=20; crewStats[c].fatigue+=10; updateCrewStats(); }},
  "Storage Closet 1": { rows:[14,18], cols:[23,27], effect:(c)=>{ crewStats[c].fatigue+=5; updateCrewStats(); }},
  "Storage Closet 2": { rows:[23,27], cols:[23,27], effect:(c)=>{ crewStats[c].fatigue+=5; updateCrewStats(); }}
};

// === Rooms object (Deck D, Vehicle Deck) ===
const roomsD = {
  "Vehicle Bay": { rows:[19,23], cols:[17,21], effect:(c)=>{ crewStats[c].morale+=5; crewStats[c].fatigue=Math.max(0,crewStats[c].fatigue-10); updateCrewStats(); }},
  "Equipment Shed": { rows:[15,19], cols:[7,11], effect:(c)=>{ crewStats[c].fatigue+=10; crewStats[c].morale-=5; updateCrewStats(); }},
  "Vehicle Parts & Storage": { rows:[19,23], cols:[7,11], effect:(c)=>{ reactorFailure(); crewStats[c].morale-=10; updateCrewStats(); }},
  "Dispatch Office": { rows:[25,29], cols:[7,11], effect:(c)=>{ crewStats[c].fatigue+=5; crewStats[c].morale-=10; updateCrewStats(); }}
};

let currentDeck = "B"; // default starting deck

function crewMove(row, col, name) {
  let deckRooms;
  if (currentDeck === "A") deckRooms = roomsA;
  else if (currentDeck === "B") deckRooms = roomsB;
  else if (currentDeck === "C") deckRooms = roomsC;
  else if (currentDeck === "D") deckRooms = roomsD;

  let inRoom = false;

  if (deckRooms) {
    for (const room in deckRooms) {
      const { rows, cols, effect } = deckRooms[room];
      if (row >= rows[0] && row <= rows[1] && col >= cols[0] && col <= cols[1]) {
        // âœ… Append log with room name
        document.getElementById("eventLog").innerText += 
          `\n${name} arrived at Row ${row + 1}, Col ${col + 1} â€” entered ${room}`;

        if (effect) effect(name);
        inRoom = true;
        break;
      }
    }
  }

  if (!inRoom) {
    // Resource drain when outside rooms
    resources.oxygen = Math.max(0, resources.oxygen - 1);
    resources.power = Math.max(0, resources.power - 1);

    if (!crewStats[name]) crewStats[name] = { fatigue: 0, morale: 100 };
    crewStats[name].fatigue = Math.min(100, crewStats[name].fatigue + 2);
    crewStats[name].morale = Math.max(0, crewStats[name].morale - 1);

    // âœ… Append log with coordinates only
    document.getElementById("eventLog").innerText += 
      `\n${name} arrived at Row ${row + 1}, Col ${col + 1} â€” no room`;
  }

  updateResources();
  updateCrewStats();
  updateShipSystems();
}

function setMap(filename, deck) {
  document.getElementById("mapImage").src = filename;
  currentDeck = deck; // "A", "B", "C", or "D"
  resources.fuel = Math.max(0, resources.fuel - 5);
  updateResources();
  document.getElementById("eventLog").innerText = `Switched to ${filename} (Deck ${deck})`;
  for (const crew in crewTokens) {
    if (crewTokens[crew]) {
      crewTokens[crew].remove();
      crewTokens[crew] = null;
      crewPositions[crew] = null;
    }
  }
}

// === Crew movement ===
function crewMove(row, col, name) {
  let inRoom = false;

  for(const room in rooms){
    const {rows,cols,effect}=rooms[room];
    if(row>=rows[0] && row<=rows[1] && col>=cols[0] && col<=cols[1]){
      document.getElementById("eventLog").innerText =
        `${name} arrived at Row ${row+1}, Column ${col+1} (${room})`;
      if(effect) effect(name);
      inRoom = true;
      break;
    }
  }

  if(!inRoom){
    resources.oxygen = Math.max(0, resources.oxygen - 1);
    resources.power = Math.max(0, resources.power - 1);
    crewStats[name].fatigue = Math.min(100, crewStats[name].fatigue + 2);
    crewStats[name].morale = Math.max(0, crewStats[name].morale - 1);
    document.getElementById("eventLog").innerText =
      `${name} arrived at Row ${row+1}, Column ${col+1}`;
  }

  updateResources();
  updateCrewStats();
}

// === Crew movement ===
function crewMove(row, col, name) {
  let inRoom = false;

  for(const room in rooms){
    const {rows,cols,effect}=rooms[room];
    if(row>=rows[0] && row<=rows[1] && col>=cols[0] && col<=cols[1]){
      document.getElementById("eventLog").innerText =
        `${name} arrived at Row ${row+1}, Column ${col+1} (${room})`;
      if(effect) effect(name);
      inRoom = true;
      break;
    }
  }

  if(!inRoom){
    resources.oxygen = Math.max(0, resources.oxygen - 1);
    resources.power = Math.max(0, resources.power - 1);
    crewStats[name].fatigue = Math.min(100, crewStats[name].fatigue + 2);
    crewStats[name].morale = Math.max(0, crewStats[name].morale - 1);
    document.getElementById("eventLog").innerText =
      `${name} arrived at Row ${row+1}, Column ${col+1}`;
  }

  updateResources();
  updateCrewStats();
}

// === Map switching ===
function setMap(filename) {
  document.getElementById("mapImage").src = filename;
  resources.fuel = Math.max(0, resources.fuel - 5);
  updateResources();
  document.getElementById("eventLog").innerText = `Switched to ${filename}`;
  for (const crew in crewTokens) {
    if (crewTokens[crew]) {
      crewTokens[crew].remove();
      crewTokens[crew] = null;
      crewPositions[crew] = null;
    }
  }
}

// === Pathfinding animation ===
function moveCrewAnimated(name, targetRow, targetCol) {
  if (!crewTokens[name]) return;
  let currentRow = crewPositions[name]?.row ?? 0;
  let currentCol = crewPositions[name]?.col ?? 0;
  const steps = [];
  while (currentCol !== targetCol) {
    currentCol += (targetCol > currentCol ? 1 : -1);
    steps.push({row: currentRow, col: currentCol});
  }
  while (currentRow !== targetRow) {
    currentRow += (targetRow > currentRow ? 1 : -1);
    steps.push({row: currentRow, col: currentCol});
  }
  let i = 0;
  const interval = setInterval(() => {
    if (i >= steps.length) {
      clearInterval(interval);
      crewPositions[name] = {row: targetRow, col: targetCol};
      crewMove(targetRow, targetCol, name);
      return;
    }
    crewTokens[name].remove();
    const step = steps[i];
    const cell = [...grid.children].find(c =>
      parseInt(c.dataset.row) === step.row &&
      parseInt(c.dataset.col) === step.col
    );
    const token = document.createElement("div");
    token.classList.add("crew-token");
    token.style.backgroundColor = crewColors[name];
    cell.appendChild(token);
    crewTokens[name] = token;
    i++;
  }, 200);
}

// === Build grid ===
const grid=document.getElementById("grid");
for(let row=0;row<40;row++){
  for(let col=0;col<40;col++){
    const cell=document.createElement("div");
    cell.dataset.row=row;
    cell.dataset.col=col;
    cell.addEventListener("click",()=>{
      if(!activeCrew){
        document.getElementById("eventLog").innerText="No crew selected!";
        return;
      }
      if(!crewTokens[activeCrew]){
        const token=document.createElement("div");
        token.classList.add("crew-token");
        token.style.backgroundColor=crewColors[activeCrew];
        cell.appendChild(token);
        crewTokens[activeCrew]=token;
        crewPositions[activeCrew]={row,col};
        crewMove(row,col,activeCrew);
      } else {
        moveCrewAnimated(activeCrew,row,col);
      }
    });
    grid.appendChild(cell);
  }
}

// === Initialize displays ===
updateResources();
updateCrewStats();
</script>

</body>
</html>
